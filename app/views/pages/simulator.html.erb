<div>
  <h1>Simulateur de paiement des congés payés</h1>

  <% if flash[:error] %>
    <p style="color: red;"><%= flash[:error] %></p>
  <% end %>

  <%= form_with url: simulator_calculate_path, method: :post, local: true, data: { turbo: false } do %>
    <label>Date de début du contrat :
      <%= date_field_tag :start_date, params[:start_date] || Date.new(2021,1,1) %>
    </label><br>

    <label>Date de fin du contrat :
      <%= date_field_tag :end_date, params[:end_date] || Date.new(2021,12,31) %>
    </label><br>

    <label>Salaire mensuel:
      <%= number_field_tag :salary, params[:salary] || 400 %>
    </label><br>

    <%= submit_tag "Calculer" %>
  <% end %>
</div>

<% if @periods.present? %>
  <hr>
  <div>
    <h2>Résultat du calcul</h2>
    <table>
      <tr>
        <th>Périodes</th>
        <th>Nombre de mois d'acquisition</th>
        <th>Nombre de jours acquis</th>
        <th>Méthode "maintien de salaire"</th>
        <th>Méthode 10%</th>
        <th>Valeur monétaire de ces jours : max des 2 méthodes à gauche</th>
      </tr>

      <% @periods.each_with_index do |period, i| %>
        <tr>
          <td><%= period.start_date %> =>  <%= period.end_date %></td>
          <td><%= period.nb_months %></td>
          <td><%= period.nb_leave_days %></td>
          <td><%= period.maintain_salary_leave_value %></td>
          <td><%= period.ten_percent_leave_value %></td>
          <td><%= period.final_leave_value %></td>
        </tr>
      <% end %>
    </table>
  </div>
<% end %>
